# sbox.py

# SBOX1 from RFC 3713 (Section 3.5.1)
SBOX1 = [
    112,130,44,236,179,39,192,229,228,133,87,53,234,12,174,65,
    35,239,107,147,69,25,165,33,237,14,79,78,29,101,146,189,
    134,184,175,143,124,235,31,206,62,48,220,95,94,197,11,26,
    166,225,57,202,213,71,93,61,217,1,90,214,81,86,108,77,
    139,13,154,102,36,96,103,30,199,8,232,80,111,237,122,127,
    104,107,58,211,132,36,135,184,180,124,17,68,16,74,152,248,
    186,35,234,31,206,62,48,220,95,94,197,11,26,166,225,57,
    202,213,71,93,61,217,1,90,214,81,86,108,77,139,13,154,
    102,36,96,103,30,199,8,232,80,111,246,219,197,110,60,249,
    150,125,130,212,18,116,243,207,109,228,108,232,232,239,219,209,
    143,115,203,113,35,21,197,203,196,73,239,197,92,13,197,113,
    120,170,180,178,252,75,157,15,240,100,145,208,169,210,61,174,
    213,66,97,109,253,226,225,237,29,153,144,104,107,136,213,70,
    197,253,78,147,60,190,89,175,155,179,8,186,142,145,106,170,
    136,34,133,148,131,49,187,212,87,147,38,52,240,238,251,225,
    64,135,118,243,85,44,64,44,6,219,161,73,218,157,38,72
]

# Derived S-boxes according to RFC 3713
SBOX2 = [SBOX1[i ^ 0xFF] for i in range(256)]  # SBOX2[x] = SBOX1[x ^ 0xFF]

SBOX3 = [((SBOX1[i] << 1) & 0xFF) | ((SBOX1[i] >> 7) & 0x01) for i in range(256)]  # 1-bit left rotation
SBOX4 = [((SBOX1[i] >> 1) & 0x7F) | ((SBOX1[i] << 7) & 0x80) for i in range(256)]  # 1-bit right rotation

def apply_sboxes(block_bytes):
    return [
        SBOX1[block_bytes[0]],
        SBOX2[block_bytes[1]],
        SBOX3[block_bytes[2]],
        SBOX4[block_bytes[3]],
        SBOX2[block_bytes[4]],
        SBOX3[block_bytes[5]],
        SBOX4[block_bytes[6]],
        SBOX1[block_bytes[7]],
    ]